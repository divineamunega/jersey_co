---
import MobileCarousel from "./MobileCarousel.astro";
import QuickViewModal from "./QuickViewModal.astro";
import { Image } from "astro:assets";
interface Props {
  items: {
    image: string;
    title: string;
    discountedPrice: string;
    originalPrice: string;
    _percentDiscount: number;
    percentDiscount: string;
    imagePath: string;
  }[];
}

const { items } = Astro.props;
---

<div class="flex w-full flex-col gap-7">
  <MobileCarousel items={items} />

  <!-- Desktop Grid -->
  <ul class="hidden flex-wrap justify-between overflow-hidden sm:flex">
    {
      items.map((item) => (
        <li class="mb-20 flex w-[48%] flex-col items-center justify-center gap-4 lg:mb-0 lg:w-[32%] xl:w-[23%]">
          <div class="group relative h-80 w-full overflow-hidden">
            <Image
              src={item.image}
              class="h-full w-full object-cover object-center transition-transform duration-500 group-hover:scale-110"
              alt={item.title}
              width={300}
              height={300}
            />
            <div class="absolute inset-0 bg-black/40 opacity-0 transition-opacity duration-300 group-hover:opacity-100" />
            <button
              class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 rounded-full border-2 border-white bg-white px-6 py-2 text-sm font-medium text-black opacity-0 transition-all duration-300 group-hover:opacity-100 hover:bg-transparent hover:text-white"
              onclick={`showQuickView({
                image: '${item.image}',
                title: '${item.title}',
                discountedPrice: '${item.discountedPrice}',
                originalPrice: '${item.originalPrice}',
                _percentDiscount: ${item._percentDiscount},
                percentDiscount: '${item.percentDiscount}',
                imagePath: '${item.imagePath}'
              })`}
            >
              Quick View
            </button>
          </div>
          <div class="flex w-full flex-col gap-3">
            <p class="text-left font-bold">{item.title}</p>
            <div class="flex items-center justify-between">
              <span class="text-2xl font-bold">{item.discountedPrice}</span>
              <div>
                {item._percentDiscount > 0 && (
                  <>
                    <span class="text-xl text-gray-500 line-through">
                      {item.originalPrice}
                    </span>
                    <span class="text-sm text-green-500">
                      -{item.percentDiscount}
                    </span>
                  </>
                )}
              </div>
            </div>
            <button class="cursor-pointer rounded-full border-2 border-black bg-black py-2 text-white transition-colors duration-300 hover:bg-white hover:text-black">
              Add to Cart
            </button>
          </div>
        </li>
      ))
    }
  </ul>
  <QuickViewModal />
</div>

<script>
  declare global {
    interface Window {
      showQuickView: (item: any) => void;
    }
  }
</script>
